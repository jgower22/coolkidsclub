<%- include('../partials/header.ejs')%>
    <main>
        <div class="text-centered">
           
            <%let numUsers = users.length;
            let admins = [];
            let patients = [];
            for (let i = 0; i < users.length; i++) {
                let user = users[i];
                if (user.role === 'Admin')
                    admins.push(user);
                if (user.role === 'Patient')
                    patients.push(user);
            }%>

            
            
            <h2>Admins (<%=admins.length%>)</h2>
            <table class="userTable">
                <tr>
                    <th>
                        Name
                    </th>
                    <th>
                        Email
                    </th>
                    <th>
                        Member Since
                    </th>
                </tr>
                <%for (let i = 0; i < admins.length; i++) {%>
                    
                    <tr>
                        
                        <%let admin = admins[i];
                        if (admin.email === email) {%>
                            <td>
                                <%=admin.firstName + ' ' + admin.lastName + ' '%><b>(you)</b>
                            </td>
                        <%} else {%>
                                <td>
                                    <a href="/users/profile/<%=admin.id%>"><%=admin.firstName + ' ' + admin.lastName + ' '%></a>
                                </td>
                        <%}%>
                        <td>
                            <%=admin.email%>
                        </td>
                        <td>
                            <%
                            createdAtDate = new Date(admin.createdAt); 
                            formattedDate = createdAtDate.toLocaleString(dateFormat);
                            formattedDate = formattedDate.split(',')[0];
                            %>
                            <%=formattedDate%>
                        </td>
                    </tr>
                <%}%>
            </table>

            <h2>Patients (<%=patients.length%>)</h2>
            <table class="userTable">
                <tr>
                    <th>
                        Name
                    </th>
                    <th>
                        Email
                    </th>
                    <th>
                        Member Since
                    </th>
                    <th>
                        Actions
                    </th>
                </tr>
                <%for (let i = 0; i < patients.length; i++) {%>
                    <tr>
                        <td>
                            <%let patient = patients[i];%>
                            <a href="/users/profile/<%=patient.id%>"><%=patient.firstName + ' ' + patient.lastName + ' '%></a>
                        </td>
                        <td>
                            <%=patient.email%>
                        </td>
                        <td>
                            <%
                            const dateFormat = {...DateTime.DATE_SHORT};
                            const createdAtDate = new Date(patient.createdAt); 
                            var formattedDate = createdAtDate.toLocaleString(dateFormat);
                            formattedDate = formattedDate.split(',')[0];
                            %>
                            <%=formattedDate%>
                        </td>
                        <td>
                            <button class="actionButton">Make Admin</button>
                        </td>
                    </tr>
                <%}%>
            </table>
            <h2>Total Users: <%=numUsers%></h2>
        </div>
    </main>
<%- include('../partials/footer.ejs')%>